<div align="center">
  <h1><b>Sublink Worker</b></h1>
  <h5><i>Serverless è‡ªéƒ¨ç½²è®¢é˜…è½¬æ¢å·¥å…·æœ€ä½³å®è·µ</i></h5>

  <a href="https://trendshift.io/repositories/12291" target="_blank">
    <img src="https://trendshift.io/api/badge/repositories/12291" alt="7Sageer%2Fsublink-worker | Trendshift" width="250" height="55"/>
  </a>

  <!-- <p>
    <a href="https://sublink-worker.sageer.me">https://sublink-worker.sageer.me</a>
  </p> -->
  <br>

  <p>
    <a href="https://deploy.workers.cloudflare.com/?url=https://github.com/7Sageer/sublink-worker">
      <img src="https://deploy.workers.cloudflare.com/button" alt="Deploy to Cloudflare Workers"/>
    </a>
  </p>
</div>

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®éƒ¨ç½²
ç‚¹å‡»ä¸Šæ–¹çš„ "Deploy to Cloudflare" æŒ‰é’®ï¼Œå³å¯å¿«é€Ÿéƒ¨ç½²æ‚¨çš„ä¸“å±è®¢é˜…è½¬æ¢æœåŠ¡ã€‚

### æ–°æ‰‹æŒ‡å—
- [è§†é¢‘æ•™ç¨‹1](https://www.youtube.com/watch?v=ZTgDm4qReyA)
- [è§†é¢‘æ•™ç¨‹2](https://www.youtube.com/watch?v=_1BfM2Chn7w)
- [è§†é¢‘æ•™ç¨‹3](https://www.youtube.com/watch?v=7abmWqCXPR8)

> ğŸ’¡ è¿™äº›æ˜¯ç”±Youtubeç¤¾åŒºæˆå‘˜åˆ¶ä½œçš„æ•™ç¨‹è§†é¢‘ï¼Œè¯¦ç»†çš„è®²è§£å¯ä»¥è®©ä½ å¿«é€Ÿä¸Šæ‰‹ã€‚ä½†æ˜¯éƒ¨åˆ†å†…å®¹å¯èƒ½ä¸æˆ‘ä»¬çš„è§è§£ä¸åŒï¼Œä¹Ÿå¯èƒ½ä¸æœ€æ–°ç‰ˆæœ¬å­˜åœ¨å·®å¼‚ï¼Œå»ºè®®åŒæ—¶å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](/docs)

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### æ”¯æŒåè®®
- ShadowSocks
- VMess
- VLESS
- Hysteria2
- Trojan
- TUIC

### æ ¸å¿ƒåŠŸèƒ½
- æ”¯æŒå¯¼å…¥ Base64 çš„ http/https è®¢é˜…é“¾æ¥ä»¥åŠå¤šç§åè®®çš„åˆ†äº«URL
- çº¯JavaScript + Cloudflare Workerå®ç°ï¼Œä¸€é”®éƒ¨ç½²ï¼Œå¼€ç®±å³ç”¨
- æ”¯æŒå›ºå®š/éšæœºçŸ­é“¾æ¥ç”Ÿæˆï¼ˆåŸºäº KVï¼‰
- æµ…è‰²/æ·±è‰²ä¸»é¢˜åˆ‡æ¢
- çµæ´»çš„ APIï¼Œæ”¯æŒè„šæœ¬åŒ–æ“ä½œ
- ä¸­æ–‡ï¼Œè‹±è¯­ï¼Œæ³¢æ–¯è¯­ä¸‰è¯­è¨€æ”¯æŒ

### å®¢æˆ·ç«¯æ”¯æŒ
- Sing-Box
- Clash
- Xray/V2Ray

### Web ç•Œé¢ç‰¹æ€§
- ç”¨æˆ·å‹å¥½çš„æ“ä½œç•Œé¢
- æä¾›å¤šç§é¢„å®šä¹‰è§„åˆ™é›†
- å¯è‡ªå»ºå…³äº geo-siteã€geo-ipã€ip-cidr å’Œ domain-suffix çš„è‡ªå®šä¹‰ç­–ç•¥ç»„

## ğŸ“– API æ–‡æ¡£

è¯¦ç»†çš„ API æ–‡æ¡£è¯·å‚è€ƒ [API-doc.md](/docs/API-doc.md)

### ä¸»è¦ç«¯ç‚¹
- `/singbox` - ç”Ÿæˆ Sing-Box é…ç½®ï¼Œå‚è€ƒ[SingBoxé…ç½®æ–‡æ¡£](https://sing-box.sagernet.org/zh/configuration/)
- `/clash` - ç”Ÿæˆ Clash é…ç½®ï¼Œå‚è€ƒ[mihomoé…ç½®æ–‡æ¡£](https://wiki.metacubex.one/config/)
- `/xray` - ç”Ÿæˆ Xray é…ç½®
- `/shorten` - ç”ŸæˆçŸ­é“¾æ¥

## ğŸ“ æœ€è¿‘æ›´æ–°

### 2025-03-08

- æ”¯æŒè‡ªå®šä¹‰UA
- å…¨é¢ä½¿ç”¨Clash Metaçš„Rule Provider

## ğŸ”§ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ index.js                 # ä¸»è¦çš„æœåŠ¡å™¨é€»è¾‘ï¼Œå¤„ç†è¯·æ±‚è·¯ç”±
â”œâ”€â”€ BaseConfigBuilder.js     # æ„å»ºåŸºç¡€é…ç½®
â”œâ”€â”€ SingboxConfigBuilder.js  # æ„å»º Sing-Box é…ç½®
â”œâ”€â”€ ClashConfigBuilder.js    # æ„å»º Clash é…ç½®
â”œâ”€â”€ ProxyParsers.js         # è§£æå„ç§ä»£ç†åè®®çš„ URL
â”œâ”€â”€ utils.js                # æä¾›å„ç§å®ç”¨å‡½æ•°
â”œâ”€â”€ htmlBuilder.js          # ç”Ÿæˆ Web ç•Œé¢
â”œâ”€â”€ style.js               # ç”Ÿæˆ Web ç•Œé¢çš„ CSS
â”œâ”€â”€ config.js              # ä¿å­˜é…ç½®ä¿¡æ¯
â””â”€â”€ docs/
    â”œâ”€â”€ API-doc.md         # API æ–‡æ¡£
    â”œâ”€â”€ update-log.md      # æ›´æ–°æ—¥å¿—
    â””â”€â”€ FAQ.md             # å¸¸è§é—®é¢˜è§£ç­”
```

## ğŸ“’ æ·»åŠ [sing-box](https://github.com/SagerNet/sing-box)ä¸ºå­æ¨¡å—

æ·»åŠ [sing-box](https://github.com/SagerNet/sing-box)ä¸ºå­æ¨¡å—ï¼Œç›®çš„æ˜¯è®©SingBoxçš„åŸºç¡€é…ç½®æ–‡ä»¶èƒ½å¤Ÿå’Œå®˜æ–¹[migration.md](https://github.com/SagerNet/sing-box/blob/stable/docs/migration.md)ä¿æŒä¸€è‡´ï¼š

```bash
git submodule add -b main https://github.com/SagerNet/sing-box.git sing-box
cd sing-box
git submodule update --init --recursive

# æŸ¥çœ‹æœ€æ–°Releaseç‰ˆæœ¬å·, ä¸º v1.11.7 (éœ€è¦å’Œä½ å®‰è£…çš„SingBoxç‰ˆæœ¬ä¸€è‡´)
# ä½†æ˜¯åœ¨å®˜æ–¹Releaseç‰ˆæœ¬, åœ¨æˆ‘çš„Win11ä¸Šè¿è¡Œå‡ºé”™, æ‰€ä»¥æˆ‘æœ€ç»ˆæ˜¯ç­¾å‡ºçš„v1.11.6ç‰ˆæœ¬
git describe --tags $(git rev-list --tags=$(git tag | grep -vE 'beta|alpha|rc') --max-count=1)
# git checkout v1.11.7
git checkout v1.11.6
git switch -c latest

# ä¸€æ¡å‘½ä»¤æå®š
git fetch --tags && git checkout $(git describe --tags $(git rev-list --tags=$(git tag | grep -vE 'beta|alpha|rc') --max-count=1)) && git switch -c latest
```

å¦‚æœæƒ³ç§»é™¤åˆšåˆšæ·»åŠ çš„å­æ¨¡å—ï¼Œç›´æ¥åˆ é™¤`sing-box`ç›®å½•æ˜¯ä¸å¯¹çš„ï¼Œæ­£ç¡®åšæ³•ï¼š

```bash
git submodule deinit -f sing-box
git rm -f sing-box
rm -rf .git/modules/sing-box
```

åœ¨Win11ä¸Šç¼–è¯‘`sing-box`ï¼š

```powershell
# è®¾ç½® GOTOOLCHAIN ç¯å¢ƒå˜é‡
$env:GOTOOLCHAIN = "local"

# è·å–ç‰ˆæœ¬ä¿¡æ¯
$version = go run ./cmd/internal/read_tag

# ç¼–è¯‘å‘½ä»¤
go build -v -trimpath -ldflags "-X 'github.com/sagernet/sing-box/constant.Version=$version' -s -w -buildid=" `
-tags "with_gvisor,with_dhcp,with_wireguard,with_reality_server,with_clash_api,with_quic,with_utls,with_tailscale" `
-o sing-box.exe ./cmd/sing-box
```

## ğŸ›œTUNæ¨¡å¼ä¸‹å†…ç½‘åŸŸåçš„è§£æ

å®éªŒå®¤é‡‡ç”¨Dockerçš„æ–¹å¼éƒ¨ç½²äº†ä¸€ä¸ª[SmartDNS](https://hub.docker.com/r/pymumu/smartdns)å®¹å™¨ç”¨äºå†…ç½‘åŸŸåçš„è§£æï¼Œ`smartdns.conf`æ–‡ä»¶å†…å®¹ï¼š

```ini
# ç›‘å¬53ç«¯å£
bind [::]:53

# å±€åŸŸç½‘åŸŸåå’ŒIPæ˜ å°„
address /ss.p7760.lan/192.168.3.200
address /comfyui.p7760.lan/192.168.3.200

address /ss.eda5k.lan/192.168.3.55
address /sb.eda5k.lan/192.168.3.112
address /fnos.eda5k.lan/192.168.3.112
address /sync.eda5k.lan/192.168.3.112

address /ss.eda007.lan/192.168.3.36
address /sb.eda007.lan/192.168.3.113
address /fnos.eda007.lan/192.168.3.113

address /github.cigit.lan/192.168.3.112
address /ca.cigit.lan/192.168.3.112
address /traefik.cigit.lan/192.168.3.112
address /ollama.cigit.lan/192.168.3.117

# ä¸Šæ¸¸DNSæœåŠ¡å™¨
server 8.8.8.8
server 1.0.0.1
server 1.2.4.8
```

å¦‚æœé‡‡ç”¨é»˜è®¤é…ç½®ï¼Œé‚£ä¹ˆTUNæ¨¡å¼ä¸‹æ˜¯æ— æ³•è®¿é—®å†…ç½‘åŸŸåçš„ï¼Œç”¨`tcpdump`è§‚å¯Ÿæµé‡å‘ç°æ˜¯SingBoxçš„TUNæ¨¡å¼å¯¼è‡´äº†é”™è¯¯è§£æã€‚ç”šè‡³ä¸èƒ½å«é”™è¯¯è§£æï¼Œå› ä¸ºå³ä½¿æˆ‘è®¾ç½®äº†SmartDNSä¸ºä¸»è¦DNSï¼Œåœ¨TUNæ¨¡å¼ä¸‹æµé‡éƒ½è¢«SingBoxæ¥ç®¡äº†ï¼Œåªè¦[DNSè§£æè§„åˆ™](https://github.com/SagerNet/sing-box/blob/v1.11.7/docs/configuration/dns/rule.zh.md)é‡Œé¢æ²¡æœ‰å†…ç½‘åŸŸåçš„è§£ææ–¹æ³•ï¼Œå®ƒéƒ½æ— æ³•æˆåŠŸè§£æåˆ°ã€‚

```bash
# Tmuxä¸‹å¼€2ä¸ªçª—å£åˆ†åˆ«æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹
sudo tcpdump -i any port 53 and host 192.168.3.53
nslookup github.cigit.lan
```

è§£å†³æ–¹æ¡ˆâ€“è‡ªå®šä¹‰SingBoxé…ç½®ï¼š

```json
{
  "dns": {
    "servers": [
      {
        "tag": "dns_proxy",
        "address": "tcp://1.1.1.1",
        "address_resolver": "dns_resolver",
        "strategy": "ipv4_only",
        "detour": "âœ… èŠ‚ç‚¹é€‰æ‹©"
      },
      {
        "tag": "dns_direct",
        "address": "https://dns.alidns.com/dns-query",
        "address_resolver": "dns_resolver",
        "strategy": "ipv4_only",
        "detour": "DIRECT"
      },
      {
        "tag": "dns_local",
        "address": "192.168.3.53",
        "detour": "DIRECT"
      },
      {
        "tag": "dns_resolver",
        "address": "223.5.5.5",
        "detour": "DIRECT"
      },
      {
        "tag": "dns_success",
        "address": "rcode://success"
      },
      {
        "tag": "dns_refused",
        "address": "rcode://refused"
      },
      {
        "tag": "dns_fakeip",
        "address": "fakeip"
      }
    ],
    "rules": [
      {
        "outbound": "any",
        "server": "dns_resolver"
      },
      {
        "domain_suffix": [
          ".internal",
          ".local",
          ".lan"
        ],
        "server": "dns_local"
      },
      {
        "rule_set": "geolocation-!cn",
        "query_type": [
          "A",
          "AAAA"
        ],
        "server": "dns_fakeip"
      },
      {
        "rule_set": "geolocation-!cn",
        "query_type": [
          "CNAME"
        ],
        "server": "dns_proxy"
      },
      {
        "query_type": [
          "A",
          "AAAA",
          "CNAME"
        ],
        "invert": true,
        "server": "dns_refused",
        "disable_cache": true
      }
    ],
    "final": "dns_direct",
    "independent_cache": true,
    "fakeip": {
      "enabled": true,
      "inet4_range": "198.18.0.0/15",
      "inet6_range": "fc00::/18"
    }
  },
  "ntp": {
    "enabled": true,
    "server": "time.apple.com",
    "server_port": 123,
    "interval": "30m",
    "detour": "DIRECT"
  },
  "inbounds": [
    {
      "type": "mixed",
      "tag": "mixed-in",
      "listen": "0.0.0.0",
      "listen_port": 10808
    },
    {
      "type": "tun",
      "tag": "tun-in",
      "address": [
        "172.10.0.1/30",
        "fdfe:dcba:9876::1/126"
      ],
      "route_address": [
        "0.0.0.0/1",
        "128.0.0.0/1",
        "::/1",
        "8000::/1"
      ],
      "route_exclude_address": [
        "192.168.0.0/16",
        "fc00::/7"
      ]
    }
  ],
  "outbounds": [
    {
      "type": "direct",
      "tag": "DIRECT"
    },
    {
      "type": "block",
      "tag": "REJECT"
    },
    {
      "type": "dns",
      "tag": "dns-out"
    }
  ],
  "route": {},
  "experimental": {
    "cache_file": {
      "enabled": true,
      "store_fakeip": true
    },
    "clash_api": {
      "external_controller": "0.0.0.0:9090",
      "external_ui": "yacd",
      "secret": "herowuking.singbox",
      "default_mode": "rule"
    }
  }
}
```

åœ¨DNSæœåŠ¡å™¨åˆ—è¡¨é‡Œé¢æ–°å¢äº†å±€åŸŸç½‘SmartDNSï¼š

```json
"dns": {
    "servers": [
			// ...
      // æ–°å¢çš„ dns_local å°±æ˜¯å±€åŸŸç½‘SmartDNSçš„åœ°å€
      {
        "tag": "dns_local",
        "address": "192.168.3.53",
        "detour": "DIRECT"
      },
			// ...
```

å¦å¤–ï¼Œåœ¨DNSè§„åˆ™é‡Œé¢å¢åŠ ä¸€ä¸ªæ ¹æ®åŸŸååç¼€åˆ¤æ–­çš„è§£æåˆ†æµè§„åˆ™ï¼š

```json
"dns": {
  	 // ...
    "rules": [      
      // ...
      // æ–°å¢çš„DNSè§£æåˆ†æµè§„åˆ™
      {
        "domain_suffix": [
          ".internal",
          ".local",
          ".lan"
        ],
        "server": "dns_local"
      },
			// ...
```

è‡³æ­¤ï¼Œé—®é¢˜å®Œç¾è§£å†³äº†ğŸ’¯

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issues å’Œ Pull Requests æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## âš ï¸ å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”ã€‚ä½¿ç”¨æœ¬é¡¹ç›®æ‰€é€ æˆçš„ä¸€åˆ‡åæœç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ï¼Œä¸å¼€å‘è€…æ— å…³ã€‚

## â­ Star History

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®ç‚¹äº® Star çš„æœ‹å‹ä»¬ï¼ğŸŒŸ

<a href="https://star-history.com/#7Sageer/sublink-worker&Date">
 <picture>
   <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=7Sageer/sublink-worker&type=Date&theme=dark" />
   <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=7Sageer/sublink-worker&type=Date" />
   <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=7Sageer/sublink-worker&type=Date" />
 </picture>
</a>



